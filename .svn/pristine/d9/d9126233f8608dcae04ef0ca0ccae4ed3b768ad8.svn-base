<template>
  <el-container class='section'>
    <el-header>
      <div class="layoutHeader">
        <div class="header clearfix">
          <a href="javascript:;" class="fl"><img src="../../assets/images/logo214-49.png" alt=""></a>
          <el-input class="fl" placeholder="搜索你感兴趣的内容" prefix-icon="el-icon-search" v-model="searchTxt"></el-input>
          <div class="link fr">
            <a href="javascript:;" class="fl app">百公驿App</a>

            <!-- 已登录 -->
            <div class="fl user" v-if="$store.state.userInfo">
              <el-dropdown trigger="click" @command="handleCommand">
                <!-- 头像 -->
                <img src="@/assets/images/pic.png" alt="" style="width:30px;height:30px">
                <el-dropdown-menu slot="dropdown">
                  <el-dropdown-item command='/userCenter'>用户中心</el-dropdown-item>
                  <el-dropdown-item command='/myHome' divided>我的主页</el-dropdown-item>
                  <el-dropdown-item command='/myWallet'>我的钱包</el-dropdown-item>
                  <el-dropdown-item command='/personalData'>账号管理</el-dropdown-item>
                  <el-dropdown-item divided @click.native='onLogout'>退出登录</el-dropdown-item>
                </el-dropdown-menu>
              </el-dropdown>
            </div>
            <!-- 未登录 -->
            <div class="fl" v-else>
              <router-link to="/login">去登录</router-link>
              <span>|</span>
              <router-link to="/register" class="red">免费注册</router-link>
            </div>

          </div>
        </div>

        <div class="nav fl">
          <!-- <el-menu router index="" :default-active="activeIndex" active-text-color="#f00" class="el-menu-demo" mode="horizontal" @select="handleSelect">
                <el-menu-item index="/">首页</el-menu-item>
                <el-menu-item index="/lectureRoom">讲堂</el-menu-item>
                <el-menu-item index="/livetv">直播</el-menu-item> -->
          <!--index="/community"  @click='menuListFn'-->
          <!-- <el-menu-item>百工社区</el-menu-item>
                <el-menu-item index="/engineering">工程圈 -->
          <!-- <div class='child_list'>
                    <ol>
                      <li v-for='(item,index) in tagsList' :key='index' @click='checkTag(index,item)'>
                        {{item.tagName}}
                      </li>
                    </ol>
                  </div> -->
          <!-- </el-menu-item>
                <el-menu-item index="/hotmessage">热点资讯</el-menu-item>
                <el-menu-item index="/plaza">广场</el-menu-item>
                <el-menu-item index="/article/list">文章</el-menu-item>
                <el-menu-item index="/questions">问答</el-menu-item>
              </el-menu> -->
          <div class="nav-main">
            <ul>
              <!-- <li :class="[activeIndex==index?'active-color':'']" v-for="(item,index) in navList" :key="index" @click="goRouter(item,index)">
                          <span>{{item.name}}</span>
                        </li> -->
              <li>
                <a href='/'>首页</a>
              </li>
              <li>
                <a href='/lectureRoom'>讲堂</a>
              </li>
              <li>
                <a href='/livetv'>直播</a>
              </li>
              <li>
                <span>百工社区</span>
                <div class='child_list'>
                  <ol>
                    <li v-for='(item,index) in tagsList' :key='index' @click='checkTag(index,item)'>
                      {{item.tagName}}
                    </li>
                  </ol>
                </div>
              </li>
              <li>
                <a href='/hotmessage'>热点资讯</a>
              </li>
              <li>
                <a href='/engineering'>工程圈</a>
              </li>
              <li>
                <a href='/questions'>问答</a>
              </li>
            </ul>
          </div>
        </div>

        <div class="publish fr">
          <router-link to="/article/publishArticle">
            <i class="el-icon-tickets"></i>发文章</router-link>
          <router-link to="/askingQuestions">
            <i class='icon iconfont'>&#xe60a;</i>提问题</router-link>
          <router-link to="/">
            <i class='icon iconfont'>&#xe63a;</i>写想法</router-link>
        </div>
      </div>
    </el-header>
    <el-main>
      <router-view />
    </el-main>
    <!-- <footerComponents></footerComponents> -->
    <!-- <div class='mask'>
            <el-dialog :visible.sync="dialogTableVisible">
              <ul>
                <li v-for='(item,index) in tagsList' :key='index' @click='checkTag(index,item)' :class="{'check': activeTag===index}" >
                  {{item.tagName}}
                </li>
              </ul>
            </el-dialog>
          </div> -->

  </el-container>
</template>

<script>
import footerComponents from '@/components/footerComponents.vue'
import api from '@/fetch'
export default {
  components: {
    footerComponents
  },
  data() {
    return {
      activeIndex: this.$route.path,
      // dialogTableVisible: false,
      searchTxt: null,
      flag: false,
      activeTag: null,
      tagsList: [],
      user: {
        name: '', // 用户昵称
        photo: '' // 用户头像
      }
    }
  },
  created() { },
  watch: {
    activeIndex() {
      return this.$route.path
    },
    // $route(to, from) {
    //   if (to.fullPath.includes('/hotmessage/')) {
    //     this.flag = true
    //   } else {
    //     this.flag = false
    //   }
    // }
  },
  mounted() {
    this.getTagsList();
  },
  methods: {
    handleSelect(key, keyPath) {
      this.activeIndex = keyPath[0]
    },
    getTagsList() {
      let arr = [];
      api.tagList().then(res => {
        res.data.records.forEach((item, index) => {
          if (!item.parentId) {
            arr.push(item)
          }
        })
      })
      this.tagsList = arr;
    },
    menuListFn() {
      this.dialogTableVisible = true;
    },
    checkTag (index,item) {
      // this.activeTag = index;
      // this.dialogTableVisible = false;
      this.$router.push({path:'/community',query:{id:item.id}});
    },
    // 退出登录
    onLogout() {
      this.$confirm('确定退出?', {
        confirmButtonText: '确定',
        cancelButtonText: '取消',
        type: 'warning',
        center: true
      })
        .then(() => {
          this.$store.commit('setUser', null)
          window.localStorage.clear()
          window.location.href = '/index'
          this.$message({
            type: 'success',
            message: '退出成功!'
          })
        })
        .catch(() => {
          this.$message({
            type: 'info',
            message: '已取消退出'
          })
        })
    },
    // 切换路径
    handleCommand(command) {
      this.$router.push(command)
    }
  }
}
</script>

<style lang="less" scope>
.el-container {
  position: relative;
  .el-header {
    height: 120px !important;
    padding: 0;
    background-color: #fff;
    .layoutHeader {
      width: 1100px;
      margin: 0 auto;
      .header {
        height: 50px;
        padding-top: 16px;
        overflow: hidden;
        line-height: 50px;
        a {
          display: inline-block;
        }
        .el-input {
          width: 450px;
          margin-left: 30px;
          float: left;
          .el-input__inner {
            height: 36px;
            border-radius: 18px;
            border: 0;
            background-color: #f4f4f4ff;
          }
          .el-input__prefix {
            left: 14px !important;
            top: 1px;
          }
        }
        .el-input--prefix .el-input__inner {
          padding-left: 40px !important;
        }
        .link {
          .app {
            margin-right: 30px;
          }
          span {
            margin: 0 10px;
          }
        }
      }
      .nav {
        width: 650px; // .el-menu--horizontal>.el-menu-item {
        //   height: auto;
        //   line-height: 0;
        //   border: none;
        // }
        // .el-menu-item {
        //   padding: 34px 30px 20px 0;
        //   color: #4a4a4a;
        // }
        // .el-menu-item,
        // .el-submenu__title {
        //   height: auto;
        //   line-height: auto !important;
        //   font-size: 16px;
        // }
        // .el-menu--horizontal>.el-menu-item.is-active {
        //   border: none;
        // }
        .nav-main {
          width: 100%;
          ul {
            position: relative;
            >li {
              padding: 0 13px;
              display: inline-block;
              line-height: 60px;
              font-size: 16px;
              color: #333333;
              height: 100%;
              position: relative;
              >span {
                >img {
                  display: inline-block;
                  padding-left: 10px;
                  vertical-align: middle;
                }
              }
              a:hover {
                cursor: pointer;
              }
              &:nth-child(1) {
                color: #ff584b;
              }
              &:nth-child(4):hover {
                .child_list {
                  display: block;
                }
              }
              .child_list {
                display: none;
                background: #fff;
                position: absolute;
                width: 250px;
                left: 0;
                top: 54px;
                z-index: 999;
                border: 1px solid #e8e8e8;
                >ol {
                  width: 100%;
                  padding: 20px 0;
                  display: flex;
                  justify-content: space-around;
                  flex-wrap: wrap;
                  >li {
                    width: 50%;
                    line-height: 30px;
                    font-weight: 400;
                    text-align: center;
                    color: #333333;
                    &:hover {
                      background: #fff;
                      color: #ff584b;
                      cursor: pointer;
                    }
                  }
                }
              }
            }
            li:hover {
              color: #ff584b;
            } // .active-color {
            //   background-color: #ff584b;
            // }
          }
        }
      }
      .publish {
        font-size: 16px;
        margin-top: 22px;
        >a {
          margin-left: 30px;
          i {
            margin-right: 5px;
          }
        }
      }
    }
  }
  .el-main {
    width: 1100px;
    padding: 0;
    margin: 0 auto;
    overflow: initial;
  }
}

// 下拉菜单样式
.el-dropdown-menu {
  padding: 0 !important;
  .el-dropdown-menu__item--divided {
    margin-top: auto;
  }
  .el-dropdown-menu__item--divided:before {
    height: auto !important;
  }
}

// .mask {
//   /deep/ .el-dialog {
//     width: 740px;
//   }
//   ul {
//     display: flex;
//     justify-content: center;
//     flex-wrap: wrap;
//     li {
//       width: 120px;
//       text-align: center;
//       height: 40px;
//       line-height: 40px;
//       background: #f3f3f5;
//       border-radius: 2px;
//       font-size: 14px;
//       font-weight: 400;
//       color: #333333;
//       margin-right: 10px;
//       margin-bottom: 10px;
//       cursor: pointer;
//     }
//     .check{
//       color: #f33535;
//       background-color: #fbf0f1;
//     }
//   }
// }
</style>
